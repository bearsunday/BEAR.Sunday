#summary リソースオブジェクト

# リソースオブジェクト 

 _Representational State Transfer(REST) は、ウェブのような分散ハイパーメディアシステムのためのソフトウェアアーキテクチャのスタイルのひとつである。 ... REST において重要な概念は、「リソース」(情報の断片) である。個々のリソースは、グローバルな識別子 (URI) により参照することができる。- wikipedia "REST"_

BEAR.SundayのリソースオブジェクトはこのRESTのリソースの特徴を内部APIとしてwebアプリケーション内に構築しようとするものです。リソースオブジェクトはリソースの状態とリクエストインターフェイス、リンク先、を持つ事ができます。



## リソースオブジェクトの種類 

リソースオブジェクトはスキーマによって区別されます。現在のsandboxアプリケーションはアプリケーションリソース(app）とページリソース(page)の２種類があります。

## リソースオブジェクトクラス 

リソースは状態とリクエストインターフェイスを持ちます。クエリーを除いた１つのURIは１つのクラスに対応します。

|| URI || Class || File ||
|| page://self/index || Sandbox\Resource\Page\Index ||Sandbox/Resource/Page/Index.php ||
|| app://self/blog/posts || Sandbox\Resource\App\Blog\Posts || Sandbox/Resource/App/Blog/Posts.php ||

リソースのリクエストリソースインターフェイスがPHPのクラスにマップされたものです。

  Note: スキーマとその処理は固定化されたものではありません。ユーザーはアプリケーションを横断するリソースに名前をつけ再利用することや、テストのために別の処理系にまかしモックにする事もできます。リソースURIは実際の実装を指定したものでなく、対象を意図として表したものです。

# リソースプロパティ
リソースは公開された5つのプロパティを持ちます。

|| プロパティ || 名前 || 意味　|| 型 ||
|| code || コード　|| 状態 || int ||
|| headers  || ヘッダー || メタ情報 || array<$name => $value> ||
|| links || リンク || リソースリンク || array<$rel => $uri>  ||
|| body || ボディ || リソース状態 || mixed ||
|| view || ビュー || リソース表現 || string||

### コード 
リソースの状態を表します。ページリソースの場合はそのままHTTPステータスになります。デフォルトは200(OK)です。

### ヘッダー 
リソースのメタ情報です。例えばページングを伴うリソースでは件数や何ページ目を表示してるか、あるいはページャーの全体件数やナビゲーション用HTMLなど本質的関心ではないメタ情報がここに格納されます。ページリソースの場合はそのままHTTPヘッダーになります。

### リンク 
リソースのリンク機能はリソース間の関係性をカプセル化します。利用するクライアントは関係性の実際を理解する必要なしに関係性を利用できます。これはwebのAタグをイメージすれば分かりやすいと思います。クリック先URLの情報はクライアントでなくサービスが管理していて、利用者はリンクテキストをクリックするだけです。関係性はリソース側にあり、クライアントにありません。

## ボディ 
リソースの真の価値はこのリソースコンテンツを表すボディにあります。型の制限はありませんが、リソースが単一でなくコンポジションされてる場合は配列になります。

例)車の走行スピードリソース
{{{
(int) 60
}}}
例)車の走行リソース
{{{
[
 'speed' => 60,
 'passenger' => 1,
 'gear' => 4
 ...
]
}}}

## ビュー 
ビューはリソースを「表現」にしたものです。例えば明日の天気リソース(app://self/wheaterh/tomorrow)は以下のようになります。

リソース状態は「晴れ」
リソース表現は「天気： <img src="sky.gif">晴れ」

# リクエストインターフェイス 

## メソッド 
リソースはリクエストに応じたインターフェイスを持つ事ができます。例えばGETリクエストだけを受け付けるリソースには`onGet`メソッドを用意します。

例  $id, $body, $titleをクエリー（引数）として受け付けるGETインターフェイス
{{{
public function onGet($id, $body, $title = 'untitle')
{
}
}}}

BEAR.Saturdayと違って通常のPHPのメソッドのように記述します。これを利用するほうは名前付き引数（ネームドパラメーター）で呼ぶので順序は関係ありません。

 Note: 前後を入れ替えても呼ぶ側に修正は必要ありません。
 Note: なるべく引数はスカラー値のみで受け取ります。

## 自らを構成します 

リクエストを受け取ったメソッド（リクエストインターフェイス）はデーターベースや外部Web API、あるいはビジネスロジックによって自らのリソースの状態を変更します。(つまり$bodyプロパティや$headers, $codeプロパティを更新します。)更新が終われば、自身を返します。
{{{
return $this
}}}

 Note: もし$this以外のものを返せば、それが$bodyに代入された$thisが返ります。例) return 3; は $this->body = 3; return $this;と同じです。